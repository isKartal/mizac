{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/index.css' %}">
{% if has_test_result %}
<link rel="stylesheet" href="{% static 'css/temperaments.css' %}">
<link rel="stylesheet" href="{% static 'css/profiles.css' %}">
{% endif %}
{% endblock %}

{% block content %}
<!-- Size Özel İçerik Bölümü - TAM SLIDER -->
{% if has_test_result %}
<div class="premium-content-section element-section {{ user_element.name|lower }}">
  <div class="premium-content-background">
    <div class="wave-top"></div>
    
    <!-- Premium Content Container -->
    <div class="premium-content-container">
      <!-- Bölüm Başlığı -->
      <div class="container">
        <div class="premium-section-title">
          <i class="fas fa-lightbulb"></i>
          <div class="section-title-content">
            <h2>{{ user_element.name }} Mizacınız İçin Özel Öneriler</h2>
            <p>Kişisel mizacınıza özel olarak seçilmiş içerikler</p>
          </div>
        </div>
      </div>

      <!-- İçerik SLIDER - TÜM EKRANLARDA SLIDER -->
      <div class="content-slider-wrapper">
        {% if user_element.contents %}
          <div class="content-slider-container">
            <!-- Kaydırma Butonları (tüm ekranlarda görünür) -->
            <button class="slider-nav-button prev-button glass-effect" 
                    id="prevSlideButton" 
                    type="button" 
                    aria-label="Önceki içerikler">
              <i class="fas fa-chevron-left" aria-hidden="true"></i>
            </button>
            <button class="slider-nav-button next-button glass-effect" 
                    id="nextSlideButton" 
                    type="button" 
                    aria-label="Sonraki içerikler">
              <i class="fas fa-chevron-right" aria-hidden="true"></i>
            </button>
            
            <!-- İçerik Slider (önerilerim sayfası ile aynı yapı) -->
            <div class="content-slider improved-slider" 
                 id="contentSlider" 
                 role="region" 
                 aria-label="{{ user_element.name }} mizacı için önerilen içerikler">
              {% for content in user_element.contents %}
                <div class="slider-card premium-card" 
                     data-content-id="{{ content.id }}" 
                     data-category="{{ content.category.id }}"
                     role="article"
                     aria-label="{{ content.title }}">
                  <div class="premium-card-inner">
                    {% if content.image %}
                      <div class="premium-card-image" 
                           style="background-image: url('{{ content.image.url }}')"
                           role="img"
                           aria-label="{{ content.title }} görseli">
                        <div class="content-element {{ user_element.name|lower }}">{{ user_element.name }}</div>
                        <div class="content-category">{{ content.category.name }}</div>
                      </div>
                    {% else %}
                      <div class="premium-card-image placeholder-image" 
                           role="img"
                           aria-label="Varsayılan içerik görseli">
                        <i class="fas fa-book-open" aria-hidden="true"></i>
                        <div class="content-element {{ user_element.name|lower }}">{{ user_element.name }}</div>
                        <div class="content-category">{{ content.category.name }}</div>
                      </div>
                    {% endif %}
                    
                    <!-- Header Yapısı: Başlık ve Kaydet Butonu Yan Yana -->
                    <div class="content-header">
                      <h3 class="content-title">{{ content.title }}</h3>
                      <button class="save-button-header {% if content.is_saved %}saved{% endif %}" 
                              data-content-id="{{ content.id }}"
                              type="button"
                              title="{% if content.is_saved %}Kaydedildi{% else %}Kaydet{% endif %}"
                              aria-label="{% if content.is_saved %}İçerik kaydedildi{% else %}İçeriği kaydet{% endif %}">
                        <i class="{% if content.is_saved %}fas{% else %}far{% endif %} fa-bookmark" aria-hidden="true"></i>
                      </button>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>
        {% else %}
          <div class="container">
            <div class="empty-state" role="status">
              <div class="empty-icon"><i class="fas fa-inbox" aria-hidden="true"></i></div>
              <p class="empty-text">{{ user_element.name }} mizacı için henüz öneri içeriği eklenmemiştir.</p>
            </div>
          </div>
        {% endif %}
      </div>
      
      <!-- Daha Fazla Öneriler Butonu -->
      <div class="container">
        <div class="suggestions-more">
          <a href="{% url 'my_suggestions' %}#kesfedin" class="more-link">
            Tüm İçerikleri Görüntüle <i class="fas fa-arrow-right"></i>
          </a>
        </div>
      </div>
    </div>
    <div class="wave-bottom"></div>
  </div>
</div>

<!-- İçerik Detay Modal -->
<div class="content-modal modern-modal" 
     id="contentModal" 
     role="dialog" 
     aria-modal="true" 
     aria-labelledby="modalTitle"
     aria-hidden="true">
  <div class="modal-container">
    <div class="modal-header">
      <div class="modal-element" id="modalElement"></div>
      
      <div class="modal-category" id="modalCategory"></div>

      <h2 id="modalTitle"></h2>
      
      <div class="modal-actions">
        <button class="modal-action-btn" id="modalSaveBtn" type="button">
          <i class="far fa-bookmark" aria-hidden="true"></i> Kaydet
        </button>
      </div>

      <button class="modal-close-button" id="closeModal" type="button" aria-label="Modalı kapat">
        <i class="fas fa-times" aria-hidden="true"></i>
      </button>
      
      <button class="modal-nav-button" id="prevModalContent" style="display: none;" type="button" aria-label="Önceki içerik">
        <i class="fas fa-chevron-left" aria-hidden="true"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="modal-content" id="modalContent">
        </div>
    </div>
    
    <div class="modal-footer" style="display: none;">
      </div>
  </div>
</div>
{% endif %}

{% if not has_test_result %}
<!-- Orijinal Hero Bölümü (giriş yapmamış veya test sonucu olmayan kullanıcılar için) -->
<section class="hero-section">
    <div class="hero-content">
        <h1 class="mizac-nedir-title">Mizacınızı Keşfedin</h1>
        <p class="mizac-nedir-text">
            Mizaç, bir kişinin doğuştan gelen, hayata bakışını ve tepkilerini şekillendiren karakter özellikleridir.
            4 ana mizaç tipinden hangisine sahip olduğunuzu öğrenmek için ücretsiz testimizi çözün.
        </p>
        <a href="{% url 'test_list' %}" class="start-test-button">TESTE BAŞLA <i class="fas fa-arrow-right"></i></a>
    </div>
</section>
{% endif %}

<section class="elements-section index-page">
    <div class="container">
        <h2 class="section-title">Dört Temel Mizaç</h2>
        <p class="section-description">Antik çağlardan günümüze kadar süregelen dört temel mizaç tipini tanıyın ve kendinizi keşfedin.</p>
        
        <div class="element-grid">
            <!-- Ateş Elementi -->
            <div class="element-card">
    <div class="card-circle fire">
        <img src="/static/images/fire-newicon.webp" alt="Fire" class="fire-icon element-icon">
    </div>
    <h3>ATEŞ</h3>
    <p>Ateş mizaçlı kişiler dinamik, hırslı ve lider ruhuyla tanınırlar. Hızlı karar verme yetenekleri ve yenilikçi düşünce tarzları ile tanınırlar.</p>
    <a href="{% url 'fire_more' %}" class="element-link">DAHA FAZLASI <i class="fas fa-arrow-right"></i></a>
</div>
    
            <!-- Hava Elementi -->
            <div class="element-card">
    <div class="card-circle air">
        <img src="/static/images/air-newicon.webp" alt="Air" class="air-icon element-icon">
    </div>
    <h3>HAVA</h3>
    <p>Hava mizaçlı kişiler iletişime açık, analitik ve sosyal yönleri güçlü kişilerdir. Farklı bakış açıları geliştirme ve analiz etme konusunda ustadırlar.</p>
    <a href="{% url 'air_more' %}" class="element-link">DAHA FAZLASI <i class="fas fa-arrow-right"></i></a>
</div>
    
            <!-- Toprak Elementi -->
            <div class="element-card">
    <div class="card-circle earth">
        <img src="/static/images/earth-bel.webp" alt="Earth" class="earth-icon element-icon">
    </div>
    <h3>TOPRAK</h3>
    <p>Toprak mizaçlı kişiler güvenilir, kararlı ve pratik düşünce yapısına sahiptirler. Organizasyon ve planlama konularında doğal yetenekleri vardır.</p>
    <a href="{% url 'earth_more' %}" class="element-link">DAHA FAZLASI <i class="fas fa-arrow-right"></i></a>
</div>
    
            <!-- Su Elementi -->
            <div class="element-card">
    <div class="card-circle water">
        <img src="/static/images/water-bel.webp" alt="Water" class="water-icon element-icon">
    </div>
    <h3>SU</h3>
    <p>Su mizaçlı kişiler duygusal derinliğe, güçlü sezgilere ve empati yeteneğine sahiptir.</p>
    <a href="{% url 'water_more' %}" class="element-link">DAHA FAZLASI <i class="fas fa-arrow-right"></i></a>
</div>
        </div>
    </div>
</section>

<section class="advantage-section">
    <div class="container">
        <h2 class="section-title">Mizaç Bilgisinin Hayatınıza Katkıları</h2>
        <p class="section-description">
            Kendinizi tanımanın en güçlü yolu mizacınızı anlamaktır. 
            İşte mizaç bilgisinin hayatınıza katacağı değerli faydalar:
        </p>
        
        <div class="advantage-grid">
            <div class="advantage-card">
                <div class="advantage-icon">
                    <i class="fas fa-brain"></i>
                </div>
                <h3>Kendinizi Anlama</h3>
                <p>Davranışlarınızın ve tepkilerinizin arkasındaki nedenleri daha iyi anlayarak kendi potansiyelinizi keşfedin.</p>
            </div>
            <div class="advantage-card">
                <div class="advantage-icon">
                    <i class="fas fa-users"></i>
                </div>
                <h3>Daha İyi İlişkiler</h3>
                <p>Kendi mizacınızı ve başkalarının mizaçlarını anlayarak daha sağlıklı ve anlamlı ilişkiler kurun.</p>
            </div>
            <div class="advantage-card">
                <div class="advantage-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h3>Kariyer Gelişimi</h3>
                <p>Mizacınıza uygun kariyer seçeneklerini belirleyerek çalışma hayatınızda daha başarılı ve mutlu olun.</p>
            </div>
        </div>
        
        <!-- Ek bilgi bölümü -->
        <div class="wisdom-section">
            <div class="wisdom-content">
                <i class="fas fa-lightbulb"></i>
                <h3>Neden Mizaç Bu Kadar Önemli?</h3>
                <p>
                    Hiç merak ettiniz mi? Neden bazı insanlar anında karar verirken, bazıları günlerce düşünür? 
                    Neden kimileri kalabalıkta enerji bulurken, kimileri yalnızlıkta huzur bulur? 
                    Bu soruların cevabı, sizin en temel yapınızda saklı: <strong>Mizacınızda</strong>.
                </p>
                <p>
                    Her birimiz dünyaya eşsiz bir "kullanım kılavuzu" ile geliriz. 
                    Bu kılavuzun sırlarını çözmek, kendinizle barışmak ve potansiyelinizi ortaya çıkarmak için doğru yerdesiniz.
                </p>
            </div>
        </div>
    </div>
</section>

<section class="final-section">
  <div class="container">
    <div class="final-content">
      <div class="final-quote">
        <i class="fas fa-quote-left"></i>
        <blockquote>"Kendini bilen, Rabbini bilir"</blockquote>
        <p>sözü, binlerce yıllık bir bilgeliği özetler. Kendini bilmenin ilk ve en temel adımı ise mizacı bilmektir.</p>
      </div>
      
      <div class="final-action">
        <h3>Hazırsanız, kendinize doğru bu eşsiz yolculuğa başlayalım!</h3>
        <p>İlk adım olarak mizaç testimizi çözebilir veya aşağıdaki mizaç türlerini inceleyerek keşfe başlayabilirsiniz.</p>
        
        <div class="final-buttons">
          <a href="{% url 'test_list' %}" class="btn-primary">
            <i class="fas fa-play-circle"></i>
            Mizaç Testini Başlat
          </a>
          <a href="{% url 'temperaments' %}" class="btn-secondary">
            <i class="fas fa-compass"></i>
            Mizaç Türlerini İncele
          </a>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Sayfa elementi görünürlüğü için IntersectionObserver kullanımı
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('appear');
                }
            });
        }, {
            threshold: 0.1
        });
    
        // Animasyon eklenecek elementler
        document.querySelectorAll('.element-card, .advantage-card, .section-title, .section-description, .premium-card').forEach(el => {
            observer.observe(el);
        });
    
        // Sectionlar için görünürlük animasyonu
        const sectionObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('show-section');
                }
            });
        }, {
            threshold: 0.1
        });
    
        document.querySelectorAll('.elements-section, .advantage-section, .cta-section, .premium-content-section').forEach(section => {
            sectionObserver.observe(section);
        });
        
        {% if has_test_result %}
        // ============================================================
        // YENİ SLIDER SİSTEMİ - TÜM EKRANLARDA ÇALIŞIR
        // ============================================================
        
        const contentSlider = document.getElementById('contentSlider');
        const prevSlideButton = document.getElementById('prevSlideButton');
        const nextSlideButton = document.getElementById('nextSlideButton');
        
        // Slider varsa işlevleri başlat
        if (contentSlider && prevSlideButton && nextSlideButton) {
            
            // Slider kaydırma fonksiyonu - tüm ekranlarda çalışır
            function scrollSlider(direction) {
                const scrollAmount = direction === 'left' ? -350 : 350;
                contentSlider.scrollBy({ 
                    left: scrollAmount, 
                    behavior: 'smooth' 
                });
            }
            
            // Buton olay dinleyicileri
            prevSlideButton.addEventListener('click', function() {
                scrollSlider('left');
            });
            
            nextSlideButton.addEventListener('click', function() {
                scrollSlider('right');
            });
            
            // Buton durumunu güncelleme fonksiyonu
            function updateSliderButtons() {
                const scrollLeft = contentSlider.scrollLeft;
                const maxScrollLeft = contentSlider.scrollWidth - contentSlider.clientWidth;
                
                // Sol buton durumu
                const isAtStart = scrollLeft <= 10;
                prevSlideButton.style.opacity = isAtStart ? "0.5" : "1";
                prevSlideButton.style.pointerEvents = isAtStart ? "none" : "all";
                
                // Sağ buton durumu
                const isAtEnd = scrollLeft >= maxScrollLeft - 10;
                nextSlideButton.style.opacity = isAtEnd ? "0.5" : "1";
                nextSlideButton.style.pointerEvents = isAtEnd ? "none" : "all";
            }
            
            // Scroll olayını dinle
            contentSlider.addEventListener('scroll', updateSliderButtons);
            
            // İlk yüklemede buton durumunu güncelle
            setTimeout(updateSliderButtons, 100);
            
            // Pencere boyutu değişiminde yeniden hesapla
            window.addEventListener('resize', function() {
                setTimeout(updateSliderButtons, 100);
            });
        }
        
        // ============================================================
        // MODAL KONTROL SİSTEMİ
        // ============================================================
        
        const contentModal = document.getElementById('contentModal');
        const closeModal = document.getElementById('closeModal');
        
        // Modal kapatma
        if (closeModal) {
            closeModal.addEventListener('click', function() {
                contentModal.classList.remove('active');
                document.body.style.overflow = '';
            });
        }
        
        // Modal dışına tıklama ile kapatma
        if (contentModal) {
            contentModal.addEventListener('click', function(e) {
                if (e.target === contentModal) {
                    contentModal.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        }
        
        // ESC tuşu ile modalı kapatma
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && contentModal.classList.contains('active')) {
                contentModal.classList.remove('active');
                document.body.style.overflow = '';
            }
        });
        
        // ============================================================
        // KART ETKİLEŞİM SİSTEMİ
        // ============================================================
        
        // Premium kart tıklama olayları
        const premiumCards = document.querySelectorAll('.premium-card');
        premiumCards.forEach(card => {
            card.addEventListener('click', function(e) {
                // Header kaydet butonunu kontrol et
                if (!e.target.closest('.save-button-header')) {
                    const contentId = this.dataset.contentId;
                    openContentModal(contentId);
                }
            });
        });
        
        // Header kaydet butonları
        const headerSaveButtons = document.querySelectorAll('.save-button-header');
        headerSaveButtons.forEach(button => {
            button.addEventListener('click', function(e) {
                e.stopPropagation();
                const contentId = this.dataset.contentId;
                toggleSave(contentId, this);
            });
        });
        
        // Modal kaydet butonu
        const modalSaveBtn = document.getElementById('modalSaveBtn');
        if (modalSaveBtn) {
            modalSaveBtn.addEventListener('click', function() {
                const contentId = this.dataset.contentId;
                toggleSave(contentId, this);
            });
        }
        
        // ============================================================
        // YARDIMCI FONKSİYONLAR
        // ============================================================
        
        // İçerik modalını açma fonksiyonu
        function openContentModal(contentId) {
            fetch(`/profiles/content/${contentId}/detail/`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('modalTitle').textContent = data.title;
                    document.getElementById('modalCategory').textContent = data.category;
                    document.getElementById('modalContent').innerHTML = data.content;
                    document.getElementById('modalElement').textContent = data.related_element;
                    document.getElementById('modalElement').className = `modal-element ${data.related_element.toLowerCase()}`;
                     const modalHeader = document.querySelector('.modal-header');
      if (modalHeader) {
        if (data.image) {
          modalHeader.style.backgroundImage = `url('${data.image}')`;
          modalHeader.classList.add('has-image');
        } else {
          modalHeader.style.backgroundImage = '';
          modalHeader.classList.remove('has-image');
        }
      }
                    // Kaydet butonunu güncelle
                    const saveBtn = document.getElementById('modalSaveBtn');
                    if (saveBtn) {
                        saveBtn.dataset.contentId = contentId;
                        saveBtn.className = `modal-action-btn${data.saved ? ' saved' : ''}`;
                        saveBtn.innerHTML = data.saved ? 
                            '<i class="fas fa-bookmark"></i> Kaydedildi' : 
                            '<i class="far fa-bookmark"></i> Kaydet';
                    }
                    
                    contentModal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                })
                .catch(error => {
                    console.error('Hata:', error);
                    alert('İçerik yüklenirken bir hata oluştu.');
                });
        }
        
        // Kaydetme işlevi
        function toggleSave(contentId, button) {
            fetch(`/profiles/content/${contentId}/toggle_save/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'),
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({})
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateSaveStatus(contentId, data.saved);
                }
            })
            .catch(error => console.error('Hata:', error));
        }
        
        // Kaydetme durumunu güncelle
        function updateSaveStatus(contentId, isSaved) {
            // Header kaydet butonlarını güncelle
            const headerSaveButtons = document.querySelectorAll(`.save-button-header[data-content-id="${contentId}"]`);
            headerSaveButtons.forEach(btn => {
                btn.classList.toggle('saved', isSaved);
                btn.title = isSaved ? 'Kaydedildi' : 'Kaydet';
                
                const icon = btn.querySelector('i');
                if (icon) {
                    icon.className = isSaved ? 'fas fa-bookmark' : 'far fa-bookmark';
                }
            });
            
            // Modal butonunu güncelle
            const modalSaveBtn = document.getElementById('modalSaveBtn');
            if (modalSaveBtn && modalSaveBtn.dataset.contentId === contentId) {
                modalSaveBtn.classList.toggle('saved', isSaved);
                modalSaveBtn.innerHTML = isSaved ? 
                    '<i class="fas fa-bookmark"></i> Kaydedildi' : 
                    '<i class="far fa-bookmark"></i> Kaydet';
            }
        }
        
        // CSRF token'ı almak için yardımcı fonksiyon
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        {% endif %}
    });
</script>
{% endblock %}